{% extends "base.html" %}
{% load render_table from django_tables2 %}

{% block head %}
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" />
<link rel="stylesheet" href="/static/assets/css/fullcalendar.css" />
<link rel="stylesheet" href="/static/assets/css/fullcalendar.print.css" media="print" />
<script src="/static/assets/js/moment.min.js"></script>
<script src="/static/assets/js/fullcalendar.min.js"></script>
<script src="/static/assets/js/facebook.js"></script>
<meta property="og:site_name" content="CNU Open Course Project"/>
<meta property="og:title" content="{{ term.name }} schedule for {{ user.first_name }} {{ user.last_name }}" />
<meta property="fb:app_id" content="886841334691353" />
<meta property="og:description" content="{{ social_desc }}" />
<style>
  form h1, h5 {
      display: inline-block;
  }
  form h5 {
    vertical-align: middle;
  }
  input {
    display: table-cell;
  }
	#calendar-tab {
		margin: 40px 10px;
		padding: 0;
		font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
		font-size: 14px;
	}
	#calendar {
		max-width: 900px;
		margin: 0 auto;
	}
</style>
<script>
$(document).ready(function() {
  $('#calendar').fullCalendar({
    defaultView: 'agendaWeek',
    header: false,
    editable: false,
    hiddenDays: [0],
    allDaySlot: false,
    events: '/schedule/calendar/course/?term={{ term.value }}',
    loading: function(isLoading, view) {
      // Hacky fix to avoid calendar loading
      if (!isLoading) {
        var lastTab = localStorage.getItem('scheduleLastTab')
        if (lastTab) {
            $('#viewTabs a[href="' + lastTab + '"]').tab('show')
        } else {
          $('#viewTabs a[href="#list-tab"]').tab('show')
        }
      }
    }
  });
  $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
    localStorage.setItem('scheduleLastTab', $(e.target).attr('href'));
  });
});
(function(d, s, id) {
  var share = "{{ share }}"
  if (share == "True") {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3&appId=886841334691353";
    fjs.parentNode.insertBefore(js, fjs);
  }
}(document, 'script', 'facebook-jssdk'));
</script>
{% endblock %}

{% block schedule-active %}active{% endblock %}
{% block content %}
<div class="container">
  <div class="well">
    {% if share %}
    <div class="fb-share-button pull-right" data-href="{{ share_url }}" data-layout="button"></div>
    {% endif %}
    <h1>
      <form action="/schedule/" method="post">
        {% if authenticated %}
        Your
        <h5>
        {% csrf_token %}
        {% for field in form %}
          {{ field }}
        {% endfor %}
        </h5>
        schedule
        {% if share %}
        <div class="input-group">
          <span class="input-group-addon" id="basic-addon1"><span class="glyphicon glyphicon-globe" aria-hidden="true"></span> Share</span>
          <input type="text" class="form-control" aria-describedby="basic-addon1" onClick="this.setSelectionRange(0, this.value.length)" value="{{ share_url }}">
        </div>
        {% else %}
        <h6>
          Your schedule looks a bit bare...
          Click <a href="/search">Search</a> to begin adding classes.
        </h6>
        {% endif %}
        {% else %}
        <strong>{{ term.name }}</strong> schedule for
        <strong>{{ user.first_name }} {{ user.last_name }}</strong>
        {% endif %}
      </form>
    </h1>
  </div>
  {% if by_id %}
  <center><mark>Click courses to see more information</mark></center>
  {% endif %}
  <div role="tabpanel">
    {% if has_exams %}
    <a href="/schedule/exam/{{ term.value }}" class="pull-right">View Exam Schedule</a>
    {% endif %}
    <ul class="nav nav-tabs" role="tablist" id="viewTabs">
      <li role="presentation"><a href="#list-tab" aria-controls="list-tab" role="tab" data-toggle="tab">List View</a></li>
      <li role="presentation" class="active"><a href="#calendar-tab" aria-controls="calendar-tab" role="tab" data-toggle="tab">Calendar View</a></li>
    </ul>
    <div class="tab-content">
      <div role="tabpanel" class="tab-pane" id="list-tab"><br>{% render_table table %}</div>
      <div role="tabpanel" class="tab-pane active" id="calendar-tab"><div id="calendar"></div></div>
    </div>
  </div>
</div>
<div id="fb-root"></div>
{% endblock %}
